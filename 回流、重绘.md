#CSS 


回流：布局引擎会根据各种样式计算各个盒子在页面上的大小与位置
重绘：当计算好盒模型的位置、大小以及其他属性后，浏览器根据每个盒子特性进行绘制

- 解析HTML，生成DOM树，解析CSS，生成CSSOM树
- 将DOM树与CSSOM树结合，生成渲染树
- 回流（Layout）：根据生成的渲染树，进行回流，得到节点的位置、大小
- 重绘（Painting）：根据渲染树以及回流得到的节点位置信息，得到节点的绝对像素
- Display将像素发送给GPU，展示在页面上

在页面初始渲染阶段，**回流**不可避免的触发
可以理解成页面一开始是空白的元素，后面添加了新的元素使页面布局发生改变

当我们对DOM的修改引发了DOM几何尺寸的变化时，浏览器需要重新计算元素的几何属性
然后将计算的结果绘制出来

当我们对DOM的修改导致了样式的变化（color、background-color），却并未影响几何属性时，浏览器不需要重新计算元素几何属性，直接为该元素绘制新的样式
这样就仅仅触发了重绘


**回流触发时机**
回流这一阶段主要是计算节点的位置和大小，那么当页面布局和几何信息发生变化时，就需要回流。如下面情况
- 添加或删除可见的DOM元素
- 元素的位置发生改变
- 元素的尺寸发生改变（包括边距、边框、宽度、大小）
- 内容发生变化（文本变化、图片被另一个不同尺寸的图片替换）
- 页面一开始渲染的时候
- 浏览器的窗口尺寸变化（因为回流是根据视口的大小，来计算元素的位置的）
- 获取到某些特定属性的值时（offsetTop、offsetWidth、scrollTop、scrollWidth、clientTop、clientWidth），这些属性都是需要通过及时计算得到的。浏览器为了获取到这些值，也会进行回流


**重绘触发时机**
触发回流一定触发重绘
可以把页面理解为一个黑板，黑板有一朵画好的小花
现在我们要把这朵从左边移动到右边
那我们要先确定好右边具体的位置，画好形状（回流）
再画上它原有的颜色（重绘）

除此之外还有一些其他的行为会引起重绘
- 颜色的修改
- 文本方向的修改
- 阴影的修改

**如何减少触发回流和重绘**
- 如果要设定元素的样式，通过改变元素的class类名
- 避免设置过多项内联样式
- 避免使用table布局，table中每个元素的大小以及内容的改变，都会导致整个table重新计算
- 对于复杂的动画，对其使用position属性的fixed值，或者absolute，尽可能使元素脱离文档流，从而减少对其他元素的影响
- 使用CSS3硬件加速，可以让transform、opacity、filters这些动画不会引起回流、重绘

将DOM属性的值缓存起来，避免每次都去获取DOM的属性
![[Pasted image 20230803224340.png]]

避免去改变样式，使用类目去合并样式
![[Pasted image 20230803224519.png]]


先设置display: none再去修改样式，最后将display恢复
![[Pasted image 20230803224641.png]]